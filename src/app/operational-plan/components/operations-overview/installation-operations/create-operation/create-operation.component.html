<div class="kx-card kx-card--skin-default" *ngIf="config && config.formList && config.formList.length > 0">
    <div class="kx-p--tiny kx-p--medium@mob-m">
        <div class="kx-row kx-row--gutters">
            <div *ngIf="selectedSections.length > 0" style="margin-left: 25px; margin-bottom: 10px;"> <b>Selected
                    Sections:</b>
                <span *ngFor="let section of selectedSections; let i = index;">
                    {{section.name}}(<span
                        *ngFor="let subSection of section.subSections; let i = index;">{{subSection.subSectionNumber}}<span
                            *ngIf="i != section.subSections.length - 1">,</span>
                    </span>)<span *ngIf="i != selectedSections.length - 1">,</span></span>
            </div>
            <app-load *ngIf="isDataLoading"></app-load>
            <form [formGroup]="formData" class="kx-row kx-row--gutters" style="width: 100%">
                <app-dynamic-form
                    class="kx-col kx-col--12 kx-col--12@mob-m kx-col--4@tab-m kx-col--10@ltp-s kx-row kx-row--gutters"
                    style="display: contents;" [form]="formData" [isFormSubmitted]="isFormSubmmited"
                    [formValues]="formValues" [config]="config" (formOnchangeEvent)="formOnchangeEvent($event)">
                </app-dynamic-form>

                <div class="kx-col kx-col--7 kx-col--5@mob-m kx-col--8@tab-m kx-col--2@ltp-s" style="margin-left: 1%;">
                    <label class="kx-label">Operator</label><small *ngIf="!selectedOperator"
                        class="u--textDanger">*</small>
                    <i class="kx-icon kx-icon--size-base" title="Select operator">
                        <a href="#" (click)="showAvailableOperators($event)">
                            <svg focusable="false">
                                <use href="./assets/img/icons/sprites/icons.svg#person"></use>
                            </svg>
                        </a>
                    </i>
                    <div class="kx-mt--tiny">
                        <input class="kx-field kx-field--size-base" type="text"
                            value="{{selectedOperator ? selectedOperator.name : '' }}" placeholder="Click person icon"
                            disabled />
                    </div>
                </div>

                <div class="kx-col kx-col--7 kx-col--5@mob-m kx-col--8@tab-m kx-col--3@ltp-s">
                    <label class="kx-label">Section & Sub-Section</label><small *ngIf="selectedSections.length == 0"
                        class="u--textDanger">*</small>

                    <div class="kx-mt--tiny">
                        <button (click)="op.toggle($event)" class="kx-btn kx-btn--skin-primary kx-btn--size-base">
                            <span class="kx-btn__inner">
                                <span class="kx-btn__txt">Select</span>
                            </span>
                        </button>
                        <p-overlayPanel #op [showCloseIcon]="true">
                            <p-tree [value]="treeData" selectionMode="checkbox" [(selection)]="selectedTreeData"
                                (onNodeSelect)="nodeSelect($event)" (onNodeUnselect)="nodeUnselect($event)"></p-tree>
                        </p-overlayPanel>
                    </div>
                    <!-- <div class="kx-mt--tiny"
                        style="border: thin solid #c3c3c4f0; border-radius: 3px; height: 150px;overflow-y: auto;">
                        <p-tree [value]="treeData" selectionMode="checkbox" [(selection)]="selectedTreeData"
                            (onNodeSelect)="nodeSelect($event)" (onNodeUnselect)="nodeUnselect($event)"></p-tree>
                    </div> -->
                </div>
                <div class="kx-card kx-card--skin-default" style="width: 100%; margin-left: 20px;">
                    <app-create-secondry-operation [sections]="sections" [gobalSelectedSubSectionId]="gobalSelectedSubSectionId" style="width: 100%;
                margin-left: 25px;" *ngIf="formData.valid" (secondaryUpdated)="secondaryListing.updateSecondaryOperationList($event)"
                        #createSecondaryOperation>
                    </app-create-secondry-operation>
                    <app-secondry-operation-listing [sections]="sections" [gobalSelectedSubSectionId]="gobalSelectedSubSectionId"  #secondaryListing [secondaryoperations]="secondaryOperationList" style="width: 100%;
                    margin-left: 25px;">
                    </app-secondry-operation-listing>
                </div>
                <div class="kx-row kx-row--gutters kx-col kx-col--12 kx-col--12@mob-m kx-col--5@tab-m kx-col--2@ltp-s"
                    style="margin: 21px 0px 0px 656px;">
                    <div class="kx-col kx-col--7 kx-col--4@mob-m kx-col--4@tab-m kx-col--4@ltp-s">
                        <button (click)="onSubmit(secondaryListing)" class="kx-btn kx-btn--skin-primary kx-btn--size-base"
                        [disabled]="(formData.valid && selectedOperator != null && selectedSections.length > 0)? false: true">
                            <span class="kx-btn__inner">
                                <span *ngIf="!editOperation; else elseBlock" class="kx-btn__txt">Add</span>
                                <ng-template #elseBlock>
                                    <span class="kx-btn__txt">Save</span>
                                </ng-template>
                            </span>
                        </button>
                    </div>
                    <div class="kx-col kx-col--4 kx-col--4@mob-m kx-col--4@tab-m kx-col--4@ltp-s">
                        <button class="kx-btn kx-btn--skin-secondary kx-btn--size-base" (click)="onFormReset()">
                            <span class="kx-btn__inner">
                                <span class="kx-btn__txt">Clear</span>
                            </span>
                        </button>
                    </div>
                    <div class="kx-col kx-col--4 kx-col--4@mob-m kx-col--2@tab-m kx-col--4@ltp-s">
                        <button class="kx-btn kx-btn--skin-secondary kx-btn--size-base" (click)="goToListOperations()">
                            <span class="kx-btn__inner">
                                <span class="kx-btn__txt">Back</span>
                            </span>
                        </button>
                    </div>
                </div>
            </form>


        </div>
    </div>
</div>



<app-modal [displayMe]="showOperatorModal">
    <div class="modal-header">
        <div>
            Select Operator
            <button class="kx-btn kx-btn--skin-secondary kx-btn--size-tiny kx-btn--icon u--modalclosebtn"
                aria-label="close modal" title="close modal" (click)="showOperatorModal = !showOperatorModal">
                <span class="kx-btn__inner">
                    <i class="kx-icon kx-icon--size-moderate">
                        <svg focusable="false">
                            <use href="./assets/img/icons/sprites/icons.svg#close">
                            </use>
                        </svg>
                    </i>
                    <span class="kx-btn__txt kx-is-vishidden">close modal</span>
                </span>
            </button>
        </div>
    </div>
    <div class="modal-body">
        <div class="kx-container kx-p--none">
            <div class="kx-card kx-card--skin-default kx-p--medium">

                <div class="kx-row kx-mt--tiny kx-mt--medium@mob-m">
                    <div class="kx-col kx-col--12">
                        <app-load *ngIf="isDataLoading"></app-load>
                        <div *ngIf="operatorList.length == 0" class="kx-card kx-card--skin-default kx-p--small">
                            No operator to select
                        </div>
                        <table *ngIf="!isDataLoading && operatorList.length > 0"
                            class="kx-table kx-table--outer-border kx-table--slim-rows u--with-tbody-scroll">
                            <thead>
                                <tr>
                                    <th style="text-align: center;">Select</th>
                                    <th style="text-align: center;">First Name</th>
                                    <th style="text-align: center;">Surname</th>
                                    <th style="text-align: center;">Availability</th>
                                    <th style="text-align: center;">Installation</th>
                                    <th style="text-align: center;">Status</th>
                                    <th style="text-align: center;">Date</th>

                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let operator of operatorList; let i = index;">
                                    <td style="text-align: center;">
                                        <input type="radio" [disabled]="!operator.availability" name="selectOperator"
                                            value="operator.Id"
                                            [checked]="operator.contactId === selectedOperator?.contactId"
                                            (change)="changeOperator(operator)" />
                                    </td>
                                    <td style="text-align: center;">{{operator.name}}</td>
                                    <td style="text-align: center;">{{operator.surName}}</td>
                                    <td style="text-align: center;">{{operator.availability ?'Availalbe': 'Booked'}}
                                    </td>
                                    <td style="text-align: center;">{{operator.operatorBooking ?
                                        operator.operatorBooking.installationName : ''}}</td>
                                    <td style="text-align: center;">{{operator.operatorBooking ?
                                        operator.operatorBooking.status : ''}}</td>
                                    <td style="text-align: center;">{{operator.operatorBooking ?
                                        operator.operatorBooking.date: null}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="kx-row">
                    <div class="kx-col kx-col--12 kx-col--3@tab-m kx-col--6@mob-m">
                        <div class="kx-mt--tiny">
                            <button (click)="showOperatorModal = !showOperatorModal; selectOperator()"
                                class="kx-btn kx-btn--skin-primary kx-btn--size-base kx-mt--tiny kx-mt--medium@mob-m"
                                [disabled]="this.selectedOperator === null">
                                <span class="kx-btn__inner">
                                    <span class="kx-btn__txt">Select</span>
                                </span>
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</app-modal>